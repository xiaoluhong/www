<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>记一次 controller manager and scheduler unavailable 问题分析 | IT老男孩</title><meta name="keywords" content="IT老男孩,rancher,github rancher,rke,rke2,k3s,docker,kubernetes,devops,多集群管理,容器,Linux运维,网络运维,最佳实践,unavailable,controller manager,scheduler"><meta name="author" content="IT老男孩"><meta name="copyright" content="IT老男孩"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文永久链接: https:&#x2F;&#x2F;www.xtplayer.cn&#x2F;kubernetes&#x2F;controller-manager-and-scheduler-unavailable&#x2F;   问题背景用户反馈经常收到告警提示: controller manager and scheduler unavailable。 问题分析 controller manager 和 scheduler 都是通过连接 AP"><meta property="og:type" content="article"><meta property="og:title" content="记一次 controller manager and scheduler unavailable 问题分析"><meta property="og:url" content="https://www.xtplayer.cn/kubernetes/controller-manager-and-scheduler-unavailable/index.html"><meta property="og:site_name" content="IT老男孩"><meta property="og:description" content="本文永久链接: https:&#x2F;&#x2F;www.xtplayer.cn&#x2F;kubernetes&#x2F;controller-manager-and-scheduler-unavailable&#x2F;   问题背景用户反馈经常收到告警提示: controller manager and scheduler unavailable。 问题分析 controller manager 和 scheduler 都是通过连接 AP"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.xtplayer.cn/img/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2021-03-24T11:47:52.000Z"><meta property="article:modified_time" content="2021-03-24T11:49:43.000Z"><meta property="article:author" content="IT老男孩"><meta property="article:tag" content="IT老男孩,rancher,github rancher,rke,rke2,k3s,docker,kubernetes,devops,多集群管理,容器,Linux运维,网络运维,最佳实践"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.xtplayer.cn/img/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" type="image/png" href="/img/favicon.png"><link rel="canonical" href="https://www.xtplayer.cn/kubernetes/controller-manager-and-scheduler-unavailable/"><link rel="preconnect" href="https//cdn.jsdelivr.net"><link rel="preconnect" href="https//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="https//hm.baidu.com"><link rel="preconnect" href="https//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet preload" as="font" href="/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/snackbar.min.css" media="print" onload='this.media="all"'><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-4244806813321801",enable_page_level_ads:"true"})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?08d495d3996be233cf4355e47874fd02";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-WDVQSZ43MX"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WDVQSZ43MX")</script><script>!function(){var c=document.createElement("script");c.src="https://sf1-scmcdn-tos.pstatp.com/goofy/ttzz/push.js?abca38a75f1ee646121b4cdefd4e13ce89e669412cb977bb98b66029e7fc3cfc8d38a1f1352cfca035e8cdfca27dc395b6c71280cecfa54b697791769b400b8d",c.id="ttzz";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(c,e)}(window)</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!1,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#121212",position:"bottom-center"},source:{jQuery:"/js/jquery.min.js",justifiedGallery:{js:"/js/jquery.justifiedGallery.min.js",css:"/css/justifiedGallery.min.css"},fancybox:{js:"/js/jquery.fancybox.min.js",css:"/css/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isanchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-03-24 19:49:43"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)});const t=saveToLocal.get("aside-status");void 0!==t&&("hide"===t?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"))})(window)</script><style>#toggle-sidebar{left:100px}</style><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="IT老男孩" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' width="110px" height="110px" alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">132</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">96</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page" href="/ad/"><i class="fa-fw fas fa-heart"></i> <span>广告</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">IT老男孩</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page" href="/ad/"><i class="fa-fw fas fa-heart"></i> <span>广告</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div class="ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4244806813321801" data-ad-slot="4594418186" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div id="post-info"><h1 class="post-title">记一次 controller manager and scheduler unavailable 问题分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表:</span> <time class="post-meta-date-created" datetime="2021-03-24T11:47:52.000Z" title="发表 2021-03-24 19:47:52">2021-03-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新:</span> <time class="post-meta-date-updated" datetime="2021-03-24T11:49:43.000Z" title="更新 2021-03-24 19:49:43">2021-03-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><span class="post-meta-label">分类:</span> <a class="post-meta-categories" href="/categories/kubernetes/">kubernetes</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span> <span class="word-count">4.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span> <span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="记一次 controller manager and scheduler unavailable 问题分析"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><p><span>本文永久链接:</span><i class="fa fa-creative-commons"></i> <a rel="noopener external nofollow noreferrer" href="https://www.xtplayer.cn/kubernetes/controller-manager-and-scheduler-unavailable/" target="_blank" title="https://www.xtplayer.cn/kubernetes/controller-manager-and-scheduler-unavailable/">https://www.xtplayer.cn/kubernetes/controller-manager-and-scheduler-unavailable/</a></p><h2 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h2><p>用户反馈经常收到告警提示: controller manager and scheduler unavailable。</p><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><ol><li><p>controller manager 和 scheduler 都是通过连接 API SERVER 去读写数据，假如 API SERVER 出现异常无法访问，将会影响 controller manager 和 scheduler 运行。</p></li><li><p>API SERVER 运行依赖 ETCD 服务，如果 ETCD 不可访问或者不可读写，那么 API SERVER 也无法向 controller manager 和 scheduler 或者其他连接 API SERVER 的应用提供服务。</p></li><li><p>有很多因素导致 ETCD 服务不可访问或者不可读写，比如：</p><ul><li><p>网络断开或者网络闪断；</p></li><li><p>三个 ETCD 节点丢失三个，最后一个节点将变成只读模式；</p></li><li><p>多个 ETCD 实例之间会通过 2380 端口通信来选举 leader，并且彼此保持心跳检测。如果节点负载增加导致 ETCD 心跳检测响应延迟，超过预定的心跳超时时间后会进行 leader 的重新选举，选举时候将会出现 ETCD 服务不可用。</p></li></ul></li></ol><h2 id="K8S-组件检查"><a href="#K8S-组件检查" class="headerlink" title="K8S 组件检查"></a>K8S 组件检查</h2><p>根据上面的问题分析，接下来查看 K8S 服务组件的日志来进一步分析。</p><p><strong>kube-scheduler</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E0321 22:47:48.503411       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-scheduler: Get https://127.0.0.1:6443/api/v1/namespaces/kube-system/endpoints/kube-scheduler?<span class="built_in">timeout</span>=10s: context deadline exceeded (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">E0321 22:51:57.230575       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-scheduler: Get https://127.0.0.1:6443/apis/coordination.k8s.io/v1/namespaces/kube-system/leases/kube-scheduler?<span class="built_in">timeout</span>=10s: context deadline exceeded</span><br><span class="line">E0321 22:54:39.196072       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-scheduler: Get https://127.0.0.1:6443/api/v1/namespaces/kube-system/endpoints/kube-scheduler?<span class="built_in">timeout</span>=10s: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br></pre></td></tr></table></figure><p><strong>kube-controller-manager</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E0321 22:47:50.884336       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-controller-manager: Get https://127.0.0.1:6443/apis/coordination.k8s.io/v1/namespaces/kube-system/leases/kube-controller-manager?<span class="built_in">timeout</span>=10s: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">I0321 22:47:53.739694       1 leaderelection.go:252] successfully acquired lease kube-system/kube-controller-manager</span><br><span class="line">I0321 22:47:53.739746       1 event.go:278] Event(v1.ObjectReference&#123;Kind:<span class="string">&quot;Endpoints&quot;</span>, Namespace:<span class="string">&quot;kube-system&quot;</span>, Name:<span class="string">&quot;k</span></span><br></pre></td></tr></table></figure><p>根据以上信息可以看出，在 UTC 0322 20:55 左右，出现了连接 API SERVER 超时的情况，接下来查看 API SERVER 服务日志。</p><p><strong>kube-apiserver</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E0321 22:47:41.289207       1 authentication.go:53] Unable to authenticate the request due to an error: [invalid bearer token, context canceled]</span><br><span class="line">E0321 22:47:48.503439       1 status.go:71] apiserver received an error that is not an metav1.Status: &amp;errors.errorString&#123;s:<span class="string">&quot;context canceled&quot;</span>&#125;</span><br><span class="line">I0321 22:47:48.503648       1 trace.go:116] Trace[1655495025]: <span class="string">&quot;Get&quot;</span> url:/api/v1/namespaces/kube-system/endpoints/kube-scheduler,user-agent:kube-scheduler/v1.18.10 (linux/amd64) kubernetes/62876fc/leader-election,client:127.0.0.1 (started: 2021-03-21 22:47:38.517639233 +0000 UTC m=+1182359.771988386) (total time: 9.985984157s):</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">Trace[723022686]: [21.463074932s] [21.463070777s] About to write a response</span><br><span class="line">W0321 22:52:07.981746       1 lease.go:224] Resetting endpoints <span class="keyword">for</span> master service <span class="string">&quot;kubernetes&quot;</span> to [10.151.130.137 10.151.130.138 10.151.130.139]</span><br><span class="line">E0321 22:54:34.697599       1 status.go:71] apiserver received an error that is not an metav1.Status: rpctypes.EtcdError&#123;code:0xe, desc:<span class="string">&quot;etcdserver: leader changed&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>根据以上信息，可以确定因为 ETCD leader changed 导致 controller manager and scheduler unavailable。</p><h2 id="ETCD-检查"><a href="#ETCD-检查" class="headerlink" title="ETCD 检查"></a>ETCD 检查</h2><p>在 API SERVER 日志中查看到了 <code>etcdserver: leader changed</code> 的提示，接下来检查 ETCD 服务日志来具体分析。</p><p><strong>ETCD</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2021-03-21 22:47:38.503291 W | rafthttp: lost the TCP streaming connection with peer 496ad58099e4ad83 (stream Message reader)</span><br><span class="line">2021-03-21 22:47:38.503313 E | rafthttp: failed to <span class="built_in">read</span> 496ad58099e4ad83 on stream Message (<span class="built_in">read</span> tcp 10.151.130.138:51268-&gt;10.151.130.139:2380: i/o <span class="built_in">timeout</span>)</span><br><span class="line">2021-03-21 22:47:38.503317 I | rafthttp: peer 496ad58099e4ad83 became inactive (message send to peer failed)</span><br><span class="line">2021-03-21 22:47:38.503628 W | rafthttp: lost the TCP streaming connection with peer ee17b2c8bf87d608 (stream Message reader)</span><br><span class="line">2021-03-21 22:47:38.503641 E | rafthttp: failed to <span class="built_in">read</span> ee17b2c8bf87d608 on stream Message (<span class="built_in">read</span> tcp 10.151.130.138:34276-&gt;10.151.130.137:2380: i/o <span class="built_in">timeout</span>)</span><br><span class="line">2021-03-21 22:47:38.503645 I | rafthttp: peer ee17b2c8bf87d608 became inactive (message send to peer failed)</span><br><span class="line">2021-03-21 22:47:38.517019 W | rafthttp: lost the TCP streaming connection with peer ee17b2c8bf87d608 (stream MsgApp v2 reader)</span><br><span class="line">2021-03-21 22:47:38.521398 W | rafthttp: lost the TCP streaming connection with peer 496ad58099e4ad83 (stream MsgApp v2 reader)</span><br><span class="line">2021-03-21 22:47:38.531432 I | rafthttp: peer ee17b2c8bf87d608 became active</span><br><span class="line">2021-03-21 22:47:38.531455 I | rafthttp: established a TCP streaming connection with peer ee17b2c8bf87d608 (stream MsgApp v2 reader)</span><br><span class="line">2021-03-21 22:47:38.531461 I | rafthttp: peer 496ad58099e4ad83 became active</span><br><span class="line">2021-03-21 22:47:38.531474 I | rafthttp: established a TCP streaming connection with peer 496ad58099e4ad83 (stream MsgApp v2 reader)</span><br><span class="line">2021-03-21 22:47:38.531599 I | rafthttp: established a TCP streaming connection with peer 496ad58099e4ad83 (stream Message reader)</span><br><span class="line">2021-03-21 22:47:38.533011 I | rafthttp: established a TCP streaming connection with peer ee17b2c8bf87d608 (stream Message reader)</span><br><span class="line">2021-03-21 22:47:38.631853 E | rafthttp: failed to write ee17b2c8bf87d608 on stream Message (write tcp 10.151.130.138:2380-&gt;10.151.130.137:36700: write: connection reset by peer)</span><br><span class="line">2021-03-21 22:47:38.631869 I | rafthttp: peer ee17b2c8bf87d608 became inactive (message send to peer failed)</span><br><span class="line">2021-03-21 22:47:38.632307 W | rafthttp: lost the TCP streaming connection with peer ee17b2c8bf87d608 (stream Message writer)</span><br><span class="line">2021-03-21 22:47:38.634600 I | rafthttp: peer ee17b2c8bf87d608 became active</span><br><span class="line">2021-03-21 22:47:40.880842 W | rafthttp: closed an existing TCP streaming connection with peer 496ad58099e4ad83 (stream Message writer)</span><br><span class="line">2021-03-21 22:47:40.880863 I | rafthttp: established a TCP streaming connection with peer 496ad58099e4ad83 (stream Message writer)</span><br><span class="line">2021-03-21 22:47:40.881069 W | rafthttp: closed an existing TCP streaming connection with peer ee17b2c8bf87d608 (stream MsgApp v2 writer)</span><br><span class="line">2021-03-21 22:47:40.881086 I | rafthttp: established a TCP streaming connection with peer ee17b2c8bf87d608 (stream MsgApp v2 writer)</span><br><span class="line">2021-03-21 22:47:40.882339 W | rafthttp: closed an existing TCP streaming connection with peer 496ad58099e4ad83 (stream MsgApp v2 writer)</span><br><span class="line">2021-03-21 22:47:40.882354 I | rafthttp: established a TCP streaming connection with peer 496ad58099e4ad83 (stream MsgApp v2 writer)</span><br><span class="line">2021-03-21 22:47:41.425089 I | rafthttp: established a TCP streaming connection with peer ee17b2c8bf87d608 (stream Message writer)</span><br></pre></td></tr></table></figure><p>通过 ETCD 日志可以确定，在 UTC 2021-03-21 22:47:38 出现了 lost the TCP streaming connection with peer 。</p><h2 id="问题定位"><a href="#问题定位" class="headerlink" title="问题定位"></a>问题定位</h2><ul><li><p>根据 ETCD 日志提示，一开始怀疑是网络闪断导致 ETCD peer 心跳超时，然后查看外部交换机网络监控，并通过工具去定时检查 ETCD 2379 和 2380 端口的健康检查，经过几天的观察未发现网络连通性异常。</p></li><li><p>通过查看系统磁盘监控，发现在告警发生的时间段，磁盘 IO 有明显的波动。</p></li><li><p>通过沟通，了解到虚拟机每天有定时快照，并且时间正好在 UTC 时间晚上 22 点 50 左右。</p></li></ul><h2 id="后续观察"><a href="#后续观察" class="headerlink" title="后续观察"></a>后续观察</h2><p>经过沟通，将定时快照的时间提前了 2 小时。根据观察告警时间以及 ETCD 出现 lost the TCP streaming connection with peer 时间相应的提前了两小时。</p><p><strong>kube-scheduler</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E0322 20:48:20.871852       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-scheduler: Get https://127.0.0.1:6443/api/v1/namespaces/kube-system/endpoints/kube-scheduler?<span class="built_in">timeout</span>=10s: context deadline exceeded (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">I0322 20:48:31.622309       1 leaderelection.go:252] successfully acquired lease kube-system/kube-scheduler</span><br><span class="line">E0322 20:52:34.275658       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-scheduler: etcdserver: leader changed</span><br><span class="line">E0322 20:55:12.950234       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-scheduler: Get https://127.0.0.1:6443/api/v1/namespaces/kube-system/endpoints/kube-scheduler?<span class="built_in">timeout</span>=10s: context deadline exceeded (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">I0322 20:55:12.950297       1 leaderelection.go:277] failed to renew lease kube-system/kube-scheduler: timed out waiting <span class="keyword">for</span> the condition</span><br><span class="line">F0322 20:55:12.950314       1 server.go:244] leaderelection lost</span><br></pre></td></tr></table></figure><p><strong>kube-controller-manager</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E0322 20:48:14.476644       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-controller-manager: etcdserver: leader changed</span><br><span class="line">E0322 20:48:28.187307       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-controller-manager: Get https://127.0.0.1:6443/api/v1/namespaces/kube-system/endpoints/kube-controller-manager?<span class="built_in">timeout</span>=10s: context deadline exceeded (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">E0322 20:52:41.226524       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-controller-manager: Get https://127.0.0.1:6443/api/v1/namespaces/kube-system/endpoints/kube-controller-manager?<span class="built_in">timeout</span>=10s: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">E0322 20:55:12.902921       1 leaderelection.go:320] error retrieving resource lock kube-system/kube-controller-manager: Get https://127.0.0.1:6443/api/v1/namespaces/kube-system/endpoints/kube-controller-manager?<span class="built_in">timeout</span>=10s: context deadline exceeded (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br></pre></td></tr></table></figure><p><strong>kube-apiserver</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">E0322 20:48:29.475790       1 status.go:71] apiserver received an error that is not an metav1.Status: rpctypes.EtcdError&#123;code:0xe, desc:<span class="string">&quot;etcdserver: request timed out&quot;</span>&#125;</span><br><span class="line">E0322 20:48:29.475844       1 status.go:71] apiserver received an error that is not an metav1.Status: rpctypes.EtcdError&#123;code:0xe, desc:<span class="string">&quot;etcdserver: request timed out&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">E0322 20:52:34.274857       1 status.go:71] apiserver received an error that is not an metav1.Status: rpctypes.EtcdError&#123;code:0xe, desc:<span class="string">&quot;etcdserver: leader changed&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>ETCD</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2021-03-22 20:30:46.088174 I | mvcc: finished scheduled compaction at 23035178 (took 26.164333ms)</span><br><span class="line">2021-03-22 20:34:52.330573 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/persistentvolumeclaims/default/nginx-logs-pvc\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:1405&quot;</span> took too long (1.669619791s) to execute</span><br><span class="line">2021-03-22 20:34:52.332649 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/services/endpoints/kube-system/kube-controller-manager\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:615&quot;</span> took too long (1.471652409s) to execute</span><br><span class="line">2021-03-22 20:34:52.333036 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/services/endpoints/kube-system/kube-scheduler\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:588&quot;</span> took too long (217.627474ms) to execute</span><br><span class="line">2021-03-22 20:34:52.333058 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/resourcequotas/\&quot; range_end:\&quot;/registry/resourcequotas0\&quot; count_only:true &quot;</span> with result <span class="string">&quot;range_response_count:0 size:9&quot;</span> took too long (630.275951ms) to execute</span><br><span class="line">2021-03-22 20:34:52.333081 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/services/endpoints/local-path-storage/rancher.io-local-path\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:653&quot;</span> took too long (394.73969ms) to execute</span><br><span class="line">2021-03-22 20:34:52.333308 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/services/specs/default/kubernetes\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:616&quot;</span> took too long (430.624112ms) to execute</span><br><span class="line">2021-03-22 20:35:46.067308 I | mvcc: store.index: compact 23036390</span><br><span class="line">2021-03-22 20:35:46.093276 I | mvcc: finished scheduled compaction at 23036390 (took 25.599134ms)</span><br><span class="line">2021-03-22 20:40:46.077355 I | mvcc: store.index: compact 23037604</span><br><span class="line">2021-03-22 20:40:46.104071 I | mvcc: finished scheduled compaction at 23037604 (took 26.305942ms)</span><br><span class="line">2021-03-22 20:43:58.958177 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/services/endpoints/kube-system/kube-controller-manager\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:615&quot;</span> took too long (702.184455ms) to execute</span><br><span class="line">2021-03-22 20:43:58.959252 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/leases/kube-system/kube-scheduler\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:491&quot;</span> took too long (687.254ms) to execute</span><br><span class="line">2021-03-22 20:43:58.959275 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/leases/kube-system/kube-controller-manager\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:518&quot;</span> took too long (651.871463ms) to execute</span><br><span class="line">2021-03-22 20:43:58.959363 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/events/\&quot; range_end:\&quot;/registry/events0\&quot; count_only:true &quot;</span> with result <span class="string">&quot;range_response_count:0 size:9&quot;</span> took too long (647.299563ms) to execute</span><br><span class="line">2021-03-22 20:45:46.088764 I | mvcc: store.index: compact 23038829</span><br><span class="line">2021-03-22 20:45:46.117371 I | mvcc: finished scheduled compaction at 23038829 (took 28.090255ms)</span><br><span class="line">2021-03-22 20:48:13.545676 W | rafthttp: lost the TCP streaming connection with peer 4bd420be9a532df8 (stream Message reader)</span><br><span class="line">2021-03-22 20:48:13.545703 E | rafthttp: failed to <span class="built_in">read</span> 4bd420be9a532df8 on stream Message (<span class="built_in">read</span> tcp 10.151.130.137:54864-&gt;10.151.130.138:2380: i/o <span class="built_in">timeout</span>)</span><br><span class="line">2021-03-22 20:48:13.545707 I | rafthttp: peer 4bd420be9a532df8 became inactive (message send to peer failed)</span><br><span class="line">2021-03-22 20:48:13.549798 W | rafthttp: lost the TCP streaming connection with peer 4bd420be9a532df8 (stream MsgApp v2 reader)</span><br><span class="line">raft2021/03/22 20:48:14 INFO: ee17b2c8bf87d608 [term: 164] received a MsgVote message with higher term from 496ad58099e4ad83 [term: 165]</span><br><span class="line">raft2021/03/22 20:48:14 INFO: ee17b2c8bf87d608 became follower at term 165</span><br><span class="line">raft2021/03/22 20:48:14 INFO: ee17b2c8bf87d608 [logterm: 164, index: 29128056, vote: 0] cast MsgVote <span class="keyword">for</span> 496ad58099e4ad83 [logterm: 164, index: 29128056] at term 165</span><br><span class="line">raft2021/03/22 20:48:14 INFO: raft.node: ee17b2c8bf87d608 lost leader 4bd420be9a532df8 at term 165</span><br><span class="line">raft2021/03/22 20:48:14 INFO: raft.node: ee17b2c8bf87d608 elected leader 496ad58099e4ad83 at term 165</span><br><span class="line">2021-03-22 20:48:14.475506 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/services/endpoints/kube-system/kube-controller-manager\&quot; &quot;</span> with result <span class="string">&quot;error:etcdserver: leader changed&quot;</span> took too long (5.299921652s) to execute</span><br><span class="line">2021-03-22 20:48:14.477440 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/services/endpoints/local-path-storage/rancher.io-local-path\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:653&quot;</span> took too long (4.456789691s) to execute</span><br><span class="line">2021-03-22 20:48:14.477462 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/storageclasses/\&quot; range_end:\&quot;/registry/storageclasses0\&quot; count_only:true &quot;</span> with result <span class="string">&quot;range_response_count:0 size:9&quot;</span> took too long (3.623175886s) to execute</span><br><span class="line">2021-03-22 20:48:14.477539 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/networkpolicies/\&quot; range_end:\&quot;/registry/networkpolicies0\&quot; count_only:true &quot;</span> with result <span class="string">&quot;range_response_count:0 size:7&quot;</span> took too long (478.668022ms) to execute</span><br><span class="line">2021-03-22 20:48:14.477622 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/rolebindings/\&quot; range_end:\&quot;/registry/rolebindings0\&quot; count_only:true &quot;</span> with result <span class="string">&quot;range_response_count:0 size:9&quot;</span> took too long (1.244980828s) to execute</span><br><span class="line">2021-03-22 20:48:14.477732 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/apiregistration.k8s.io/apiservices/\&quot; range_end:\&quot;/registry/apiregistration.k8s.io/apiservices0\&quot; count_only:true &quot;</span> with result <span class="string">&quot;range_response_count:0 size:9&quot;</span> took too long (2.397168285s) to execute</span><br><span class="line">2021-03-22 20:48:16.618038 I | rafthttp: peer 4bd420be9a532df8 became active</span><br><span class="line">2021-03-22 20:48:16.618059 I | rafthttp: established a TCP streaming connection with peer 4bd420be9a532df8 (stream MsgApp v2 reader)</span><br><span class="line">2021-03-22 20:48:16.624716 W | rafthttp: closed an existing TCP streaming connection with peer 4bd420be9a532df8 (stream MsgApp v2 writer)</span><br><span class="line">2021-03-22 20:48:16.624736 I | rafthttp: established a TCP streaming connection with peer 4bd420be9a532df8 (stream MsgApp v2 writer)</span><br><span class="line">2021-03-22 20:48:16.624878 I | rafthttp: established a TCP streaming connection with peer 4bd420be9a532df8 (stream Message reader)</span><br><span class="line">2021-03-22 20:48:16.627175 W | rafthttp: closed an existing TCP streaming connection with peer 4bd420be9a532df8 (stream Message writer)</span><br><span class="line">2021-03-22 20:48:16.627188 I | rafthttp: established a TCP streaming connection with peer 4bd420be9a532df8 (stream Message writer)</span><br><span class="line">WARNING: 2021/03/22 20:48:23 grpc: Server.processUnaryRPC failed to write status: connection error: desc = <span class="string">&quot;transport is closing&quot;</span></span><br><span class="line">2021-03-22 20:50:46.088074 I | mvcc: store.index: compact 23040043</span><br></pre></td></tr></table></figure><h2 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h2><p>通过商议，决定取消 ETCD 虚拟机的定时快照。经过一天运行，ETCD 运行日志中没有再出现 lost the TCP streaming connection with peer 。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2021-03-23 19:58:04.190676 I | etcdserver: saved snapshot at index 29600607</span><br><span class="line">2021-03-23 19:58:04.190832 I | etcdserver: compacted raft <span class="built_in">log</span> at 29595607</span><br><span class="line">2021-03-23 19:58:33.388856 I | pkg/fileutil: purged file /var/lib/rancher/etcd/member/snap/00000000000000a7-0000000001bfdaca.snap successfully</span><br><span class="line">2021-03-23 20:00:48.065975 I | mvcc: store.index: compact 23379302</span><br><span class="line">2021-03-23 20:00:48.091487 I | mvcc: finished scheduled compaction at 23379302 (took 25.110115ms)</span><br><span class="line">2021-03-23 20:02:39.378543 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/configmaps/ingress-nginx/ingress-controller-leader-nginx\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:607&quot;</span> took too long (117.791832ms) to execute</span><br><span class="line">2021-03-23 20:05:48.073024 I | mvcc: store.index: compact 23380519</span><br><span class="line">2021-03-23 20:05:48.100228 I | mvcc: finished scheduled compaction at 23380519 (took 26.693346ms)</span><br><span class="line">2021-03-23 20:10:48.079058 I | mvcc: store.index: compact 23381735</span><br><span class="line">2021-03-23 20:10:48.106893 I | mvcc: finished scheduled compaction at 23381735 (took 27.437585ms)</span><br><span class="line">2021-03-23 20:15:30.155491 I | wal: segmented wal file /var/lib/rancher/etcd/member/wal/000000000000015a-0000000001c3c1fc.wal is created</span><br><span class="line">2021-03-23 20:15:33.414322 I | pkg/fileutil: purged file /var/lib/rancher/etcd/member/wal/0000000000000155-0000000001bcc554.wal successfully</span><br><span class="line">2021-03-23 20:15:48.095615 I | mvcc: store.index: compact 23382954</span><br><span class="line">2021-03-23 20:15:48.122662 I | mvcc: finished scheduled compaction at 23382954 (took 26.68459ms)</span><br><span class="line">2021-03-23 20:20:48.092179 I | mvcc: store.index: compact 23384166</span><br><span class="line">2021-03-23 20:20:48.118647 I | mvcc: finished scheduled compaction at 23384166 (took 26.050565ms)</span><br><span class="line">2021-03-23 20:25:48.097468 I | mvcc: store.index: compact 23385389</span><br><span class="line">2021-03-23 20:25:48.125829 I | mvcc: finished scheduled compaction at 23385389 (took 28.006118ms)</span><br><span class="line">2021-03-23 20:30:48.103474 I | mvcc: store.index: compact 23386608</span><br><span class="line">2021-03-23 20:30:48.131849 I | mvcc: finished scheduled compaction at 23386608 (took 27.984451ms)</span><br><span class="line">2021-03-23 20:35:48.118190 I | mvcc: store.index: compact 23387819</span><br><span class="line">2021-03-23 20:35:48.144807 I | mvcc: finished scheduled compaction at 23387819 (took 26.220415ms)</span><br><span class="line">2021-03-23 20:40:48.124117 I | mvcc: store.index: compact 23389036</span><br><span class="line">2021-03-23 20:40:48.150120 I | mvcc: finished scheduled compaction at 23389036 (took 25.643958ms)</span><br><span class="line">2021-03-23 20:45:48.130181 I | mvcc: store.index: compact 23390248</span><br><span class="line">2021-03-23 20:45:48.156873 I | mvcc: finished scheduled compaction at 23390248 (took 26.303108ms)</span><br><span class="line">2021-03-23 20:50:48.136542 I | mvcc: store.index: compact 23391473</span><br><span class="line">2021-03-23 20:50:48.168088 I | mvcc: finished scheduled compaction at 23391473 (took 31.146475ms)</span><br><span class="line">2021-03-23 20:55:48.141884 I | mvcc: store.index: compact 23392692</span><br><span class="line">2021-03-23 20:55:48.168249 I | mvcc: finished scheduled compaction at 23392692 (took 25.983679ms)</span><br><span class="line">2021-03-23 21:00:48.148486 I | mvcc: store.index: compact 23393921</span><br><span class="line">2021-03-23 21:00:48.175167 I | mvcc: finished scheduled compaction at 23393921 (took 26.323769ms)</span><br><span class="line">2021-03-23 21:05:48.153553 I | mvcc: store.index: compact 23395139</span><br><span class="line">2021-03-23 21:05:48.179843 I | mvcc: finished scheduled compaction at 23395139 (took 25.890462ms)</span><br><span class="line">2021-03-23 21:10:48.159706 I | mvcc: store.index: compact 23396363</span><br><span class="line">2021-03-23 21:10:48.186493 I | mvcc: finished scheduled compaction at 23396363 (took 26.422307ms)</span><br><span class="line">2021-03-23 21:15:48.165114 I | mvcc: store.index: compact 23397590</span><br><span class="line">2021-03-23 21:15:48.191193 I | mvcc: finished scheduled compaction at 23397590 (took 25.715209ms)</span><br><span class="line">2021-03-23 21:20:48.171112 I | mvcc: store.index: compact 23398807</span><br><span class="line">2021-03-23 21:20:48.198116 I | mvcc: finished scheduled compaction at 23398807 (took 26.516055ms)</span><br><span class="line">2021-03-23 21:25:48.176894 I | mvcc: store.index: compact 23400025</span><br><span class="line">2021-03-23 21:25:48.205417 I | mvcc: finished scheduled compaction at 23400025 (took 28.06852ms)</span><br><span class="line">2021-03-23 21:30:48.182368 I | mvcc: store.index: compact 23401248</span><br><span class="line">2021-03-23 21:30:48.208162 I | mvcc: finished scheduled compaction at 23401248 (took 25.359328ms)</span><br><span class="line">2021-03-23 21:35:48.188427 I | mvcc: store.index: compact 23402496</span><br><span class="line">2021-03-23 21:35:48.214977 I | mvcc: finished scheduled compaction at 23402496 (took 26.130896ms)</span><br><span class="line">2021-03-23 21:40:48.203757 I | mvcc: store.index: compact 23403714</span><br><span class="line">2021-03-23 21:40:48.230346 I | mvcc: finished scheduled compaction at 23403714 (took 26.234451ms)</span><br><span class="line">2021-03-23 21:45:48.203085 I | mvcc: store.index: compact 23404944</span><br><span class="line">2021-03-23 21:45:48.232110 I | mvcc: finished scheduled compaction at 23404944 (took 28.66739ms)</span><br><span class="line">2021-03-23 21:50:48.211722 I | mvcc: store.index: compact 23406161</span><br><span class="line">2021-03-23 21:50:48.238941 I | mvcc: finished scheduled compaction at 23406161 (took 26.80059ms)</span><br><span class="line">2021-03-23 21:55:48.221035 I | mvcc: store.index: compact 23407381</span><br><span class="line">2021-03-23 21:55:48.248858 I | mvcc: finished scheduled compaction at 23407381 (took 27.422759ms)</span><br><span class="line">2021-03-23 22:00:48.229789 I | mvcc: store.index: compact 23408597</span><br><span class="line">2021-03-23 22:00:48.257402 I | mvcc: finished scheduled compaction at 23408597 (took 27.233652ms)</span><br><span class="line">2021-03-23 22:05:48.243738 I | mvcc: store.index: compact 23409819</span><br><span class="line">2021-03-23 22:05:48.269861 I | mvcc: finished scheduled compaction at 23409819 (took 25.728754ms)</span><br><span class="line">2021-03-23 22:10:48.249241 I | mvcc: store.index: compact 23411044</span><br><span class="line">2021-03-23 22:10:48.275749 I | mvcc: finished scheduled compaction at 23411044 (took 26.150918ms)</span><br><span class="line">2021-03-23 22:15:48.254890 I | mvcc: store.index: compact 23412261</span><br><span class="line">2021-03-23 22:15:48.281103 I | mvcc: finished scheduled compaction at 23412261 (took 25.838699ms)</span><br><span class="line">2021-03-23 22:20:13.800090 W | etcdserver: read-only range request <span class="string">&quot;key:\&quot;/registry/ranges/serviceips\&quot; &quot;</span> with result <span class="string">&quot;range_response_count:1 size:8223&quot;</span> took too long (208.151939ms) to execute</span><br><span class="line">2021-03-23 22:20:48.264931 I | mvcc: store.index: compact 23413481</span><br><span class="line">2021-03-23 22:20:48.290955 I | mvcc: finished scheduled compaction at 23413481 (took 25.550081ms)</span><br><span class="line">2021-03-23 22:25:38.543370 I | etcdserver: start to snapshot (applied: 29650608, lastsnap: 29600607)</span><br><span class="line">2021-03-23 22:25:38.547640 I | etcdserver: saved snapshot at index 29650608</span><br><span class="line">2021-03-23 22:25:38.547810 I | etcdserver: compacted raft <span class="built_in">log</span> at 29645608</span><br><span class="line">2021-03-23 22:25:48.270855 I | mvcc: store.index: compact 23414700</span><br><span class="line">2021-03-23 22:25:48.298973 I | mvcc: finished scheduled compaction at 23414700 (took 27.738717ms)</span><br><span class="line">2021-03-23 22:26:03.434776 I | pkg/fileutil: purged file /var/lib/rancher/etcd/member/snap/00000000000000a7-0000000001c09e1b.snap successfully</span><br><span class="line">2021-03-23 22:30:48.275888 I | mvcc: store.index: compact 23415924</span><br><span class="line">2021-03-23 22:30:48.305413 I | mvcc: finished scheduled compaction at 23415924 (took 29.128337ms)</span><br><span class="line">2021-03-23 22:35:48.280997 I | mvcc: store.index: compact 23417141</span><br><span class="line">2021-03-23 22:35:48.307847 I | mvcc: finished scheduled compaction at 23417141 (took 26.42452ms)</span><br><span class="line">2021-03-23 22:40:48.287720 I | mvcc: store.index: compact 23418356</span><br><span class="line">2021-03-23 22:40:48.317291 I | mvcc: finished scheduled compaction at 23418356 (took 29.183932ms)</span><br><span class="line">2021-03-23 22:45:48.295599 I | mvcc: store.index: compact 23419585</span><br><span class="line">2021-03-23 22:45:48.322346 I | mvcc: finished scheduled compaction at 23419585 (took 26.370195ms)</span><br><span class="line">2021-03-23 22:50:48.301478 I | mvcc: store.index: compact 23420817</span><br><span class="line">2021-03-23 22:50:48.327555 I | mvcc: finished scheduled compaction at 23420817 (took 25.656891ms)</span><br><span class="line">2021-03-23 22:55:48.307901 I | mvcc: store.index: compact 23422034</span><br><span class="line">2021-03-23 22:55:48.337474 I | mvcc: finished scheduled compaction at 23422034 (took 29.204046ms)</span><br><span class="line">2021-03-23 23:00:48.314532 I | mvcc: store.index: compact 23423249</span><br><span class="line">2021-03-23 23:00:48.340979 I | mvcc: finished scheduled compaction at 23423249 (took 26.109985ms)</span><br><span class="line">2021-03-23 23:05:48.319811 I | mvcc: store.index: compact 23424469</span><br><span class="line">2021-03-23 23:05:48.346462 I | mvcc: finished scheduled compaction at 23424469 (took 26.255207ms)</span><br><span class="line">2021-03-23 23:10:48.326553 I | mvcc: store.index: compact 23425683</span><br><span class="line">2021-03-23 23:10:48.353562 I | mvcc: finished scheduled compaction at 23425683 (took 26.632973ms)</span><br><span class="line">2021-03-23 23:15:48.333217 I | mvcc: store.index: compact 23426896</span><br><span class="line">2021-03-23 23:15:48.359319 I | mvcc: finished scheduled compaction at 23426896 (took 25.72745ms)</span><br><span class="line">2021-03-23 23:20:48.339558 I | mvcc: store.index: compact 23428115</span><br><span class="line">2021-03-23 23:20:48.366617 I | mvcc: finished scheduled compaction at 23428115 (took 26.658721ms)</span><br><span class="line">2021-03-23 23:25:48.345722 I | mvcc: store.index: compact 23429337</span><br><span class="line">2021-03-23 23:25:48.373084 I | mvcc: finished scheduled compaction at 23429337 (took 27.017076ms)</span><br><span class="line">2021-03-23 23:30:48.351550 I | mvcc: store.index: compact 23430561</span><br><span class="line">2021-03-23 23:30:48.378308 I | mvcc: finished scheduled compaction at 23430561 (took 26.3218ms)</span><br><span class="line">2021-03-23 23:35:48.356635 I | mvcc: store.index: compact 23431805</span><br><span class="line">2021-03-23 23:35:48.382235 I | mvcc: finished scheduled compaction at 23431805 (took 25.195416ms)</span><br><span class="line">2021-03-23 23:40:48.362534 I | mvcc: store.index: compact 23433019</span><br><span class="line">2021-03-23 23:40:48.388744 I | mvcc: finished scheduled compaction at 23433019 (took 25.639283ms)</span><br><span class="line">2021-03-23 23:45:48.368555 I | mvcc: store.index: compact 23434235</span><br><span class="line">2021-03-23 23:45:48.395256 I | mvcc: finished scheduled compaction at 23434235 (took 26.290222ms)</span><br><span class="line">2021-03-23 23:50:48.373567 I | mvcc: store.index: compact 23435452</span><br><span class="line">2021-03-23 23:50:48.405420 I | mvcc: finished scheduled compaction at 23435452 (took 31.411081ms)</span><br><span class="line">2021-03-23 23:55:48.379145 I | mvcc: store.index: compact 23436674</span><br><span class="line">2021-03-23 23:55:48.405956 I | mvcc: finished scheduled compaction at 23436674 (took 26.306194ms)</span><br><span class="line">2021-03-24 00:00:48.384095 I | mvcc: store.index: compact 23437902</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">IT老男孩</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://www.xtplayer.cn/kubernetes/controller-manager-and-scheduler-unavailable/">https://www.xtplayer.cn/kubernetes/controller-manager-and-scheduler-unavailable/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a rel="noopener noreferrer" href="https://www.xtplayer.cn" target="_blank">IT老男孩</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/kubernetes/mountvolume-waitforattach-failed-for-volume-with-structure-needs-cleaning/"><img class="prev-cover" src="/img/gkihqEjXxJ5UZ1C.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MountVolume.WaitForAttach failed for volume with “structure needs cleaning”</div></div></a></div><div class="next-post pull-right"><a href="/rancher/replace-ip-domain/"><img class="next-cover" src="/img/gkihqEjXxJ5UZ1C.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">变更 Rancher Server IP 或域名</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i> <span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/kubernetes/about-kubernetes-1.20/" title="了解 Kubernetes 1.20"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-15</div><div class="title">了解 Kubernetes 1.20</div></div></a></div><div><a href="/kubernetes/api-server-and-etcd-health-state-check/" title="Api Server 和 ETCD 健康状态检查"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-22</div><div class="title">Api Server 和 ETCD 健康状态检查</div></div></a></div><div><a href="/kubernetes/automatic-k8s-deployment-tool/" title="K8S 自动部署工具"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-06</div><div class="title">K8S 自动部署工具</div></div></a></div><div><a href="/kubernetes/autoscaling/" title="Kubernetes 规范中标签的重要性"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-19</div><div class="title">Kubernetes 规范中标签的重要性</div></div></a></div><div><a href="/kubernetes/concepts-and-matters/" title="Kubernetes 概念及其重要性"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-15</div><div class="title">Kubernetes 概念及其重要性</div></div></a></div><div><a href="/kubernetes/custom-serviceaccount/" title="自定义服务账户（Service Account）"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-09</div><div class="title">自定义服务账户（Service Account）</div></div></a></div><div><a href="/kubernetes/docker-credentials-secret/" title="记一次镜像仓库凭证相关问题分析"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-23</div><div class="title">记一次镜像仓库凭证相关问题分析</div></div></a></div><div><a href="/kubernetes/fast-migration-pod-when-node-unavailable/" title="K8S 节点不可用时快速迁移 Pods"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-09-16</div><div class="title">K8S 节点不可用时快速迁移 Pods</div></div></a></div><div><a href="/kubernetes/forces-delete-terminated-namespace/" title="强制删除 Terminating 状态的 namespace"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-01</div><div class="title">强制删除 Terminating 状态的 namespace</div></div></a></div><div><a href="/kubernetes/ingress-configuration-demo/" title="Ingress 常用配置（持续更新）"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-11</div><div class="title">Ingress 常用配置（持续更新）</div></div></a></div><div><a href="/kubernetes/k8s-automatic-elastic-expansion/" title="Kubernetes 自动弹性伸缩"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-02</div><div class="title">Kubernetes 自动弹性伸缩</div></div></a></div><div><a href="/kubernetes/k8s-basic-environment-configuration/" title="k8s 基础环境配置"><img class="cover" src="/img/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-13</div><div class="title">k8s 基础环境配置</div></div></a></div></div></div><div class="ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4244806813321801" data-ad-slot="9845679202" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' width="110px" height="110px" alt="avatar"><div class="author-info__name">IT老男孩</div><div class="author-info__description">IT老男孩 - 原名系统玩家，分享 IT 相关技术文章，分享工作中的最佳实践。</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">132</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">96</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xiaoluhong" target="_blank" rel="external nofollow noreferrer noopener" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1044281310@qq.com" target="_blank" rel="external nofollow noreferrer noopener" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录导航</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">问题背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#K8S-%E7%BB%84%E4%BB%B6%E6%A3%80%E6%9F%A5"><span class="toc-number">3.</span> <span class="toc-text">K8S 组件检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ETCD-%E6%A3%80%E6%9F%A5"><span class="toc-number">4.</span> <span class="toc-text">ETCD 检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D"><span class="toc-number">5.</span> <span class="toc-text">问题定位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E8%A7%82%E5%AF%9F"><span class="toc-number">6.</span> <span class="toc-text">后续观察</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95"><span class="toc-number">7.</span> <span class="toc-text">处理方法</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rancher/waiting-for-node-to-register-either-cluster-is-not-ready-for-registering-or-etcd-and-controlplane-node-have-to-be-registered-first/" title="Waiting for node to register. Either cluster is not ready for registering or etcd and controlplane node have to be registered first">Waiting for node to register. Either cluster is not ready for registering or etcd and controlplane node have to be registered first</a><time datetime="2022-09-17T06:33:50.000Z" title="发表 2022-09-17 14:33:50">2022-09-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/mysql/how-to-get-the-sizes-of-the-tables-of-a-mysql-database/" title="如何查看 MySQL 数据库容量大小，表容量大小，索引容量大小？">如何查看 MySQL 数据库容量大小，表容量大小，索引容量大小？</a><time datetime="2022-05-17T08:48:50.000Z" title="发表 2022-05-17 16:48:50">2022-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rancher/either-cluster-is-not-ready-for-registering/" title="node-agent 报错 Either cluster is not ready for registering, cluster is currently provisioning, or etcd, controlplane and worker node have to be registered">node-agent 报错 Either cluster is not ready for registering, cluster is currently provisioning, or etcd, controlplane and worker node have to be registered</a><time datetime="2022-05-14T05:13:09.000Z" title="发表 2022-05-14 13:13:09">2022-05-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/prometheus/prometheus-adapter/" title="Prometheus Adapter 安装">Prometheus Adapter 安装</a><time datetime="2022-04-04T08:26:12.000Z" title="发表 2022-04-04 16:26:12">2022-04-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/prometheus/custom-parameter/" title="自定义集群监控参数">自定义集群监控参数</a><time datetime="2022-03-28T11:10:20.000Z" title="发表 2022-03-28 19:10:20">2022-03-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rancher/rancher-new-forums/" title="全新论坛启用，Rancher 中文社区迈入新阶段">全新论坛启用，Rancher 中文社区迈入新阶段</a><time datetime="2022-03-25T13:16:03.000Z" title="发表 2022-03-25 21:16:03">2022-03-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/coredns/accelerate-external-domain-resolution/" title="coreDNS 加速外部域名解析">coreDNS 加速外部域名解析</a><time datetime="2021-07-17T05:12:27.000Z" title="发表 2021-07-17 13:12:27">2021-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/longhorn/ai-at-the-edge-with-k3s-nvidia-jetson-nano-object-detection-real-time-video-analytics-src/" title="AI at the Edge with K3s and NVIDIA Jetson Nano: Object Detection and Real-Time Video Analytics">AI at the Edge with K3s and NVIDIA Jetson Nano: Object Detection and Real-Time Video Analytics</a><time datetime="2021-04-20T16:22:57.000Z" title="发表 2021-04-21 00:22:57">2021-04-21</time></div></div></div></div><div class="card-widget ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4244806813321801" data-ad-slot="5141213090" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By IT老男孩</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn"><img class="icp-icon" width="25px" height="17px" src="/img/icp.png" alt="icp"><span>蜀ICP备20023095号-1</span></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51010702002006"><span>川公网安备51010702002006号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text" aria-label="Search"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/instantpage.min.js" type="module"></script><script src="/js/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="5169987169" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><link rel="stylesheet" href="/css/APlayer.min.css" media="print" onload='this.media="all"'><script src="/js/APlayer.min.js"></script><script src="/js/Meting.min.js"></script><script src="/js/pjax.min.js"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!0,scrollRestoration:!1});document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","G-WDVQSZ43MX",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:send",(function(){if("object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="/js/busuanzi.pure.mini.js"></script><script>!function(){var e=document.createElement("script");e.src="https://sf1-scmcdn-tos.pstatp.com/goofy/ttzz/push.js?abca38a75f1ee646121b4cdefd4e13cef04782c449861f0dbdffcd879911999e0ea61db5c17bca91cb6b39891e5c5ae8de9c557b8186e0f895b49e96a4810ca7",e.id="ttzz";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(e,c)}(window)</script></div></body></html>