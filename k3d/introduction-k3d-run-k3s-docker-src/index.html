<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Introduction to k3d: Run K3s in Docker | IT老男孩</title><meta name="keywords" content="IT老男孩,rancher,github rancher,rke,rke2,k3s,docker,kubernetes,devops,多集群管理,容器,Linux运维,网络运维,最佳实践,k3d"><meta name="author" content="IT老男孩"><meta name="copyright" content="IT老男孩"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文永久链接: https:&#x2F;&#x2F;www.xtplayer.cn&#x2F;k3d&#x2F;introduction-k3d-run-k3s-docker-src&#x2F;  In this blog post, we’re going to talk about k3d, a tool that allows you to run throwaway Kubernetes clusters anywhere you hav"><meta property="og:type" content="article"><meta property="og:title" content="Introduction to k3d: Run K3s in Docker"><meta property="og:url" content="https://www.xtplayer.cn/k3d/introduction-k3d-run-k3s-docker-src/index.html"><meta property="og:site_name" content="IT老男孩"><meta property="og:description" content="本文永久链接: https:&#x2F;&#x2F;www.xtplayer.cn&#x2F;k3d&#x2F;introduction-k3d-run-k3s-docker-src&#x2F;  In this blog post, we’re going to talk about k3d, a tool that allows you to run throwaway Kubernetes clusters anywhere you hav"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.xtplayer.cn/img/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2021-03-03T12:11:50.000Z"><meta property="article:modified_time" content="2021-03-23T14:58:20.000Z"><meta property="article:author" content="IT老男孩"><meta property="article:tag" content="k3d"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.xtplayer.cn/img/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" type="image/png" href="/img/favicon.png"><link rel="canonical" href="https://www.xtplayer.cn/k3d/introduction-k3d-run-k3s-docker-src/"><link rel="preconnect" href="https//cdn.jsdelivr.net"><link rel="preconnect" href="https//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="https//hm.baidu.com"><link rel="preconnect" href="https//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet preload" as="font" href="/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/snackbar.min.css" media="print" onload='this.media="all"'><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-4244806813321801",enable_page_level_ads:"true"})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?08d495d3996be233cf4355e47874fd02";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-WDVQSZ43MX"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WDVQSZ43MX")</script><script>!function(){var c=document.createElement("script");c.src="https://sf1-scmcdn-tos.pstatp.com/goofy/ttzz/push.js?abca38a75f1ee646121b4cdefd4e13ce89e669412cb977bb98b66029e7fc3cfc8d38a1f1352cfca035e8cdfca27dc395b6c71280cecfa54b697791769b400b8d",c.id="ttzz";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(c,e)}(window)</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!1,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#121212",position:"bottom-center"},source:{jQuery:"/js/jquery.min.js",justifiedGallery:{js:"/js/jquery.justifiedGallery.min.js",css:"/css/justifiedGallery.min.css"},fancybox:{js:"/js/jquery.fancybox.min.js",css:"/css/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isanchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-03-23 22:58:20"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)});const t=saveToLocal.get("aside-status");void 0!==t&&("hide"===t?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"))})(window)</script><style>#toggle-sidebar{left:100px}</style><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="IT老男孩" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' width="110px" height="110px" alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">132</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">96</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page" href="/ad/"><i class="fa-fw fas fa-heart"></i> <span>广告</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">IT老男孩</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page" href="/ad/"><i class="fa-fw fas fa-heart"></i> <span>广告</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div class="ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4244806813321801" data-ad-slot="4594418186" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div id="post-info"><h1 class="post-title">Introduction to k3d: Run K3s in Docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表:</span> <time class="post-meta-date-created" datetime="2021-03-03T12:11:50.000Z" title="发表 2021-03-03 20:11:50">2021-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新:</span> <time class="post-meta-date-updated" datetime="2021-03-23T14:58:20.000Z" title="更新 2021-03-23 22:58:20">2021-03-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><span class="post-meta-label">分类:</span> <a class="post-meta-categories" href="/categories/k3d/">k3d</a></span><span class="post-meta tags"><span class="post-meta-separator">|</span><i class="fas fa-tag post-meta-icon"></i><span class="post-meta-label">标签:</span> <a class="post-meta-tags" href="/tags/k3d/">k3d</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span> <span class="word-count">1.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span> <span>11分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Introduction to k3d: Run K3s in Docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><p><span>本文永久链接:</span><i class="fa fa-creative-commons"></i> <a rel="noopener external nofollow noreferrer" href="https://www.xtplayer.cn/k3d/introduction-k3d-run-k3s-docker-src/" target="_blank" title="https://www.xtplayer.cn/k3d/introduction-k3d-run-k3s-docker-src/">https://www.xtplayer.cn/k3d/introduction-k3d-run-k3s-docker-src/</a></p><p>In this blog post, we’re going to talk about k3d, a tool that allows you to run throwaway Kubernetes clusters anywhere you have Docker installed. I’ve anticipated your questions — so let’s go!</p><h2 id="What-is-k3d"><a href="#What-is-k3d" class="headerlink" title="What is k3d?"></a>What is k3d?</h2><p>k3d is a small program made for running a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://k3s.io/">K3s</a> cluster in Docker. K3s is a lightweight, CNCF-certified Kubernetes distribution and Sandbox project. Designed for low-resource environments, K3s is distributed as a single binary that uses under 512MB of RAM. To learn more about K3s, head over to <a target="_blank" rel="noopener external nofollow noreferrer" href="https://rancher.com/docs/k3s/latest/en/">the documentation</a> or check out this <a target="_blank" rel="noopener external nofollow noreferrer" href="https://rancher.com/blog/2019/2019-02-26-introducing-k3s-the-lightweight-kubernetes-distribution-built-for-the-edge/">blog post</a> or <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.youtube.com/watch?v=hMr3prm9gDM">video.</a></p><p>k3d uses a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hub.docker.com/r/rancher/k3s/tags">Docker image</a> built from the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher/k3s">K3s repository</a> to spin up multiple K3s nodes in Docker containers on any machine with Docker installed. That way, a single physical (or virtual) machine (let’s call it Docker Host) can run multiple K3s clusters, with multiple server and agent nodes each, simultaneously.</p><h2 id="What-Can-k3d-Do"><a href="#What-Can-k3d-Do" class="headerlink" title="What Can k3d Do?"></a>What Can k3d Do?</h2><p>As of k3d version v4.0.0, released in January 2021, k3d’s abilities boil down to the following features:</p><ul><li>create&#x2F;stop&#x2F;start&#x2F;delete&#x2F;grow&#x2F;shrink K3s clusters (and individual nodes)<ul><li>via command line flags</li><li>via configuration file</li></ul></li><li>manage and interact with container registries that can be used with the cluster</li><li>manage Kubeconfigs for the clusters</li><li>import images from your local Docker daemon into the container runtime running in the cluster</li></ul><p>Obviously, there’s way more to it and you can tweak everything in great detail.</p><h2 id="What-is-k3d-Used-for"><a href="#What-is-k3d-Used-for" class="headerlink" title="What is k3d Used for?"></a>What is k3d Used for?</h2><p>The main use case for k3d is local development on Kubernetes with little hassle and resource usage. The intention behind the initial development of k3d was to provide developers with an easy tool that allowed them to run a lightweight Kubernetes cluster on their development machine, giving them fast iteration times in a production-like environment (as opposed to running docker-compose locally vs. Kubernetes in production).</p><p>Over time, k3d also evolved into a tool used by operations to test some Kubernetes (or, specifically K3s) features in an isolated environment. For example, with k3d you can easily create multi-node clusters, deploy something on top of it, simply stop a node and see how Kubernetes reacts and possibly reschedules your app to other nodes.</p><p>Additionally, you can use k3d in your continuous integration system to quickly spin up a cluster, deploy your test stack on top of it and run integration tests. Once you’re finished, you can simply decommission the cluster as a whole. No need to worry about proper cleanups and possible leftovers.</p><p>We also provide a <code>k3d-dind</code> image (similar to dreams within dreams in the movie Inception, we’ve got containers within containers within containers.) With that, you can create a docker-in-docker environment where you run k3d, which spawns a K3s cluster in Docker. That means that you only have a single container (k3d-dind) running on your Docker host, which in turn runs a whole K3s&#x2F;Kubernetes cluster inside.</p><h2 id="How-Do-I-Use-k3d"><a href="#How-Do-I-Use-k3d" class="headerlink" title="How Do I Use k3d?"></a>How Do I Use k3d?</h2><ol><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://k3d.io/#installation">Install k3d</a> (and <a target="_blank" rel="noopener external nofollow noreferrer" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a> , if you want to use it)<br><strong>Note</strong>: to follow along with this post, use at least k3d v4.1.1</li><li>Try one of the following examples or use the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://k3d.io/usage/commands/">documentation</a> or the CLI help text to find your own way (<code>k3d [command] --help</code>)</li></ol><h3 id="The-“Simple”-Way"><a href="#The-“Simple”-Way" class="headerlink" title="The “Simple” Way"></a>The “Simple” Way</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">k3d cluster create</span><br></pre></td></tr></table></figure><p>This single command spawns a K3s cluster with two containers: A Kubernetes control-plane node (server) and a load balancer (serverlb) in front of it. It puts both of them in a dedicated Docker network and exposes the Kubernetes API on a randomly chosen free port on the Docker host. It also creates a named Docker volume in the background as a preparation for image imports.</p><p>By default, if you don’t provide a name argument, the cluster will be named <code>k3s-default</code><br>and the containers will show up as <code>k3d-&lt;-role&gt;-&lt;#&gt;</code>, so in this case <code>k3d-k3s-default-serverlb</code> and <code>k3d-k3s-default-server-0</code>.</p><p>k3d waits until everything is ready, pulls the Kubeconfig from the cluster and merges it with your default Kubeconfig (usually it’s in <code>$HOME/.kube/config</code> or whatever path your <code>KUBECONFIG</code> environment variable points to).</p><p>No worries, you can tweak that behavior as well.</p><p>Check out what you’ve just created using <code>kubectl</code> to show you the nodes: <code>kubectl get nodes</code>.</p><p>k3d also gives you some commands to list your creations: <code>k3d cluster|node|registry list</code>.</p><h3 id="The-“Simple-but-Sophisticated”-Way"><a href="#The-“Simple-but-Sophisticated”-Way" class="headerlink" title="The “Simple but Sophisticated” Way"></a>The “Simple but Sophisticated” Way</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">k3d cluster create mycluster --api-port 127.0.0.1:6445 --servers 3 --agents 2 --volume &#x27;/home/me/mycode:/code@agent[*]&#x27; --port &#x27;8080:80@loadbalancer&#x27;</span><br></pre></td></tr></table></figure><p>This single command spawns a K3s cluster with six containers:</p><ul><li>1 load balancer</li><li>3 servers (control-plane nodes)</li><li>2 agents (formerly worker nodes)</li></ul><p>With the <code>--api-port 127.0.0.1:6445</code>, you tell k3d to map the Kubernetes API Port (<code>6443</code> internally) to <code>127.0.0.1</code>&#x2F;localhost’s port <code>6445</code>. That means that you will have this connection string in your Kubeconfig: <code>server: https://127.0.0.1:6445</code> to connect to this cluster.</p><p>This port will be mapped from the load balancer to your host system. From there, requests will be proxied to your server nodes, effectively simulating a production setup, where server nodes also can go down and you would want to failover to another server.</p><p>The <code>--volume /home/me/mycode:/code@agent[*]</code> bind mounts your local directory <code>/home/me/mycode</code> to the path <code>/code</code> inside all (<code>[*]</code> of your agent nodes). Replace <code>*</code> with an index (here: 0 or 1) to only mount it into one of them.</p><p>The specification telling k3d which nodes it should mount the volume to is called “node filter” and it’s also used for other flags, like the <code>--port</code> flag for port mappings.</p><p>That said, <code>--port &#39;8080:80@loadbalancer&#39;</code> maps your local host’s port <code>8080</code> to port <code>80</code> on the load balancer (serverlb), which can be used to forward HTTP ingress traffic to your cluster. For example, you can now deploy a web app into the cluster (Deployment), which is exposed (Service) externally via an Ingress such as <code>myapp.k3d.localhost</code>.</p><p>Then (provided that everything is set up to resolve that domain to your local host IP), you can point your browser to <code>http://myapp.k3d.localhost:8080</code> to access your app. Traffic then flows from your host through the Docker bridge interface to the load balancer. From there, it’s proxied to the cluster, where it passes via Ingress and Service to your application Pod.</p><p><strong>Note</strong>: You have to have some mechanism set up to route to resolve <code>myapp.k3d.localhost</code> to your local host IP (<code>127.0.0.1</code>). The most common way is using entries of the form <code>127.0.0.1 myapp.k3d.localhost</code> in your <code>/etc/hosts</code> file (<code>C:\Windows\System32\drivers\etc\hosts</code> on Windows). However, this does not allow for wildcard entries (<code>*.localhost</code>), so it may become a bit cumbersome after a while, so you may want to have a look at tools like <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Dnsmasq"><code>dnsmasq</code> (MacOS&#x2F;UNIX</a>) or <a target="_blank" rel="noopener external nofollow noreferrer" href="https://stackoverflow.com/a/9695861/6450189"><code>Acrylic</code> (Windows)</a> to ease the burden.</p><p><strong>Tip</strong>: You can install the package <code>libnss-myhostname</code> on some systems (at least Linux operating systems including SUSE Linux and openSUSE), to auto-resolve <code>*.localhost</code> domains to <code>127.0.0.1</code>, which means you don’t have to fiddle around with e.g. <code>/etc/hosts</code>, if you prefer to test via Ingress, where you need to set a domain.</p><p>One interesting thing to note here: if you create more than one server node, K3s will be given the <code>--cluster-init</code> flag, which means that it swaps its internal datastore (by default that’s SQLite) for etcd.</p><h3 id="The-“Configuration-as-Code”-Way"><a href="#The-“Configuration-as-Code”-Way" class="headerlink" title="The “Configuration as Code” Way"></a>The “Configuration as Code” Way</h3><p>As of k3d v4.0.0 (January 2021), we support config files to configure everything as code that you’d previously do via command line flags (and soon possibly even more than that).<br>As of this writing, the JSON-Schema used to validate the configuration file can be <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher/k3d/blob/092f26a4e27eaf9d3a5bc32b249f897f448bc1ce/pkg/config/v1alpha2/schema.json">found in the repository</a>.</p><p>Here’s an example config file:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># k3d configuration file, saved as e.g. /home/me/myk3dcluster.yaml</span></span><br><span class="line">apiVersion: k3d.io/v1alpha2 <span class="comment"># this will change in the future as we make everything more stable</span></span><br><span class="line">kind: Simple <span class="comment"># internally, we also have a Cluster config, which is not yet available externally</span></span><br><span class="line">name: mycluster <span class="comment"># name that you want to give to your cluster (will still be prefixed with `k3d-`)</span></span><br><span class="line">servers: 1 <span class="comment"># same as `--servers 1`</span></span><br><span class="line">agents: 2 <span class="comment"># same as `--agents 2`</span></span><br><span class="line">kubeAPI: <span class="comment"># same as `--api-port 127.0.0.1:6445`</span></span><br><span class="line"> hostIP: <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line"> hostPort: <span class="string">&quot;6445&quot;</span></span><br><span class="line">ports:</span><br><span class="line"> - port: 8080:80 <span class="comment"># same as `--port 8080:80@loadbalancer</span></span><br><span class="line"> nodeFilters:</span><br><span class="line"> - loadbalancer</span><br><span class="line">options:</span><br><span class="line"> k3d: <span class="comment"># k3d runtime settings</span></span><br><span class="line">   <span class="built_in">wait</span>: <span class="literal">true</span> <span class="comment"># wait for cluster to be usable before returining; same as `--wait` (default: true)</span></span><br><span class="line">   <span class="built_in">timeout</span>: <span class="string">&quot;60s&quot;</span> <span class="comment"># wait timeout before aborting; same as `--timeout 60s`</span></span><br><span class="line"> k3s: <span class="comment"># options passed on to K3s itself</span></span><br><span class="line">   extraServerArgs: <span class="comment"># additional arguments passed to the `k3s server` command</span></span><br><span class="line">     - --tls-san=my.host.domain</span><br><span class="line">   extraAgentArgs: [] <span class="comment"># addditional arguments passed to the `k3s agent` command</span></span><br><span class="line"> kubeconfig:</span><br><span class="line">   updateDefaultKubeconfig: <span class="literal">true</span> <span class="comment"># add new cluster to your default Kubeconfig; same as `--kubeconfig-update-default` (default: true)</span></span><br><span class="line">   switchCurrentContext: <span class="literal">true</span> <span class="comment"># also set current-context to the new cluster&#x27;s context; same as `--kubeconfig-switch-context` (default: true)</span></span><br></pre></td></tr></table></figure><p>Assuming that we saved this as <code>/home/me/myk3dcluster.yaml</code>, we can use it to configure a new cluster:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">k3d cluster create --config /home/me/myk3dcluster.yaml</span><br></pre></td></tr></table></figure><p>Note that you can still set additional arguments or flags, which will then take precedence (or will be merged) with whatever you have defined in the config file.</p><h2 id="What-More-Can-I-Do-with-k3d"><a href="#What-More-Can-I-Do-with-k3d" class="headerlink" title="What More Can I Do with k3d?"></a>What More Can I Do with k3d?</h2><p>You can use k3d in even more ways, including:</p><ul><li>Create a cluster together with a k3d-managed container <strong>registry</strong></li><li>Use the cluster for fast development with <strong>hot code reloading</strong></li><li>Use k3d in combination with other development tools like <code>Tilt</code> or <code>Skaffold</code><ul><li>both can leverage the power of importing images via <code>k3d image import</code></li><li>both can alternatively make use of a k3d-managed registry to speed up your development loop</li></ul></li><li>Use k3d in your CI system (we have a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/iwilltry42/k3d-demo/blob/main/.drone.yml">PoC for that</a>)</li><li>Integrate it in your vscode workflow using the awesome new <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/inercia/vscode-k3d">community-maintained vscode extension</a></li><li>Use it to <a target="_blank" rel="noopener external nofollow noreferrer" href="https://rancher.com/blog/2020/set-up-k3s-high-availability-using-k3d">set up K3s high availability</a></li></ul><p>You can try all of these yourself by using prepared scripts in <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/iwilltry42/k3d-demo">this demo repository</a> or watch us showing them off in <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.youtube.com/watch?v=d9JRb4fk5ag&feature=youtu.be">one of our meetups</a>.</p><p>Other than that, remember that k3d is a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher/k3d/blob/main/CONTRIBUTING.md">community-driven</a> project, so we’re always happy to hear from you on <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher/k3d/issues">Issues</a>, <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher/k3d/issues">Pull Requests</a>, <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher/k3d/discussions">Discussions</a> and <a target="_blank" rel="noopener external nofollow noreferrer" href="https://slack.rancher.io/">Slack Chats</a>!</p><p>Ready to give k3d a try? <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/k3s-io/k3s/releases">Start by downloading K3s</a>.</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">IT老男孩</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://www.xtplayer.cn/k3d/introduction-k3d-run-k3s-docker-src/">https://www.xtplayer.cn/k3d/introduction-k3d-run-k3s-docker-src/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a rel="noopener noreferrer" href="https://www.xtplayer.cn" target="_blank">IT老男孩</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k3d/">k3d</a></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/rancher/Rancher2.x-migrate-custom-k8s-cluster/"><img class="prev-cover" src="/img/gkihqEjXxJ5UZ1C.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">重磅出击: Rancher 2.4.x 迁移自定义 k8s 集群</div></div></a></div><div class="next-post pull-right"><a href="/kubernetes/k8s-automatic-elastic-expansion/"><img class="next-cover" src="/img/gkihqEjXxJ5UZ1C.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Kubernetes 自动弹性伸缩</div></div></a></div></nav><div class="ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4244806813321801" data-ad-slot="9845679202" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' width="110px" height="110px" alt="avatar"><div class="author-info__name">IT老男孩</div><div class="author-info__description">IT老男孩 - 原名系统玩家，分享 IT 相关技术文章，分享工作中的最佳实践。</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">132</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">96</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/rancher"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xiaoluhong" target="_blank" rel="external nofollow noreferrer noopener" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1044281310@qq.com" target="_blank" rel="external nofollow noreferrer noopener" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录导航</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-k3d"><span class="toc-number">1.</span> <span class="toc-text">What is k3d?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-Can-k3d-Do"><span class="toc-number">2.</span> <span class="toc-text">What Can k3d Do?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-k3d-Used-for"><span class="toc-number">3.</span> <span class="toc-text">What is k3d Used for?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-Do-I-Use-k3d"><span class="toc-number">4.</span> <span class="toc-text">How Do I Use k3d?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-%E2%80%9CSimple%E2%80%9D-Way"><span class="toc-number">4.1.</span> <span class="toc-text">The “Simple” Way</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-%E2%80%9CSimple-but-Sophisticated%E2%80%9D-Way"><span class="toc-number">4.2.</span> <span class="toc-text">The “Simple but Sophisticated” Way</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-%E2%80%9CConfiguration-as-Code%E2%80%9D-Way"><span class="toc-number">4.3.</span> <span class="toc-text">The “Configuration as Code” Way</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-More-Can-I-Do-with-k3d"><span class="toc-number">5.</span> <span class="toc-text">What More Can I Do with k3d?</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rancher/waiting-for-node-to-register-either-cluster-is-not-ready-for-registering-or-etcd-and-controlplane-node-have-to-be-registered-first/" title="Waiting for node to register. Either cluster is not ready for registering or etcd and controlplane node have to be registered first">Waiting for node to register. Either cluster is not ready for registering or etcd and controlplane node have to be registered first</a><time datetime="2022-09-17T06:33:50.000Z" title="发表 2022-09-17 14:33:50">2022-09-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/mysql/how-to-get-the-sizes-of-the-tables-of-a-mysql-database/" title="如何查看 MySQL 数据库容量大小，表容量大小，索引容量大小？">如何查看 MySQL 数据库容量大小，表容量大小，索引容量大小？</a><time datetime="2022-05-17T08:48:50.000Z" title="发表 2022-05-17 16:48:50">2022-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rancher/either-cluster-is-not-ready-for-registering/" title="node-agent 报错 Either cluster is not ready for registering, cluster is currently provisioning, or etcd, controlplane and worker node have to be registered">node-agent 报错 Either cluster is not ready for registering, cluster is currently provisioning, or etcd, controlplane and worker node have to be registered</a><time datetime="2022-05-14T05:13:09.000Z" title="发表 2022-05-14 13:13:09">2022-05-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/prometheus/prometheus-adapter/" title="Prometheus Adapter 安装">Prometheus Adapter 安装</a><time datetime="2022-04-04T08:26:12.000Z" title="发表 2022-04-04 16:26:12">2022-04-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/prometheus/custom-parameter/" title="自定义集群监控参数">自定义集群监控参数</a><time datetime="2022-03-28T11:10:20.000Z" title="发表 2022-03-28 19:10:20">2022-03-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/rancher/rancher-new-forums/" title="全新论坛启用，Rancher 中文社区迈入新阶段">全新论坛启用，Rancher 中文社区迈入新阶段</a><time datetime="2022-03-25T13:16:03.000Z" title="发表 2022-03-25 21:16:03">2022-03-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/coredns/accelerate-external-domain-resolution/" title="coreDNS 加速外部域名解析">coreDNS 加速外部域名解析</a><time datetime="2021-07-17T05:12:27.000Z" title="发表 2021-07-17 13:12:27">2021-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/longhorn/ai-at-the-edge-with-k3s-nvidia-jetson-nano-object-detection-real-time-video-analytics-src/" title="AI at the Edge with K3s and NVIDIA Jetson Nano: Object Detection and Real-Time Video Analytics">AI at the Edge with K3s and NVIDIA Jetson Nano: Object Detection and Real-Time Video Analytics</a><time datetime="2021-04-20T16:22:57.000Z" title="发表 2021-04-21 00:22:57">2021-04-21</time></div></div></div></div><div class="card-widget ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4244806813321801" data-ad-slot="5141213090" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By IT老男孩</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn"><img class="icp-icon" width="25px" height="17px" src="/img/icp.png" alt="icp"><span>蜀ICP备20023095号-1</span></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51010702002006"><span>川公网安备51010702002006号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text" aria-label="Search"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/instantpage.min.js" type="module"></script><script src="/js/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="5169987169" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><link rel="stylesheet" href="/css/APlayer.min.css" media="print" onload='this.media="all"'><script src="/js/APlayer.min.js"></script><script src="/js/Meting.min.js"></script><script src="/js/pjax.min.js"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!0,scrollRestoration:!1});document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","G-WDVQSZ43MX",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:send",(function(){if("object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="/js/busuanzi.pure.mini.js"></script><script>!function(){var e=document.createElement("script");e.src="https://sf1-scmcdn-tos.pstatp.com/goofy/ttzz/push.js?abca38a75f1ee646121b4cdefd4e13cef04782c449861f0dbdffcd879911999e0ea61db5c17bca91cb6b39891e5c5ae8de9c557b8186e0f895b49e96a4810ca7",e.id="ttzz";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(e,c)}(window)</script></div></body></html>